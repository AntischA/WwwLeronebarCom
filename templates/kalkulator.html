<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/kalkulator.css') }}">

</head>


<body>
    <div class="container">
        <form id="calculatorForm">

            <div class="top-section">
                <div class="section calculator">
                    <div class="input-area">
                        <div class="form-group">
                            <label>Polog (€):</label>
                            <input type="number" id="pocetni-polog" name="pocetni_polog" value="350">
                        </div>
                        <div class="form-group">
                            <label>Promet (€):</label>
                            <input type="number" id="dnevni-promet" name="dnevni_promet">
                        </div>
                    </div>
                </div>
            </div>

            <div class="bottom-section">
                <div class="section currency">
                    <h2>Kovanice i Gotovina</h2>
                    <div class="currency-input">
                        <!-- Kovanice i Gotovina -->
                        <div class="currency-item">
                            <img src="{{ url_for('static', filename='KovaniceNovcanice/0.1euro.jpg') }}" alt="0.10€" data-value="0.1">
                            <input type="number" id="novcanica-0.1" name="novcanica-0.1" value="">
                        </div>
                        <div class="currency-item">
                            <img src="{{ url_for('static', filename='KovaniceNovcanice/0.2euro.jpg') }}" alt="0.20€" data-value="0.2">
                            <input type="number" id="novcanica-0.2" name="novcanica-0.2" value="">
                        </div>
                        <div class="currency-item">
                            <img src="{{ url_for('static', filename='KovaniceNovcanice/0.5euro.jpg') }}" alt="0.50€" data-value="0.5">
                            <input type="number" id="novcanica-0.5" name="novcanica-0.5" value="">
                        </div>
                        <div class="currency-item">
                            <img src="{{ url_for('static', filename='KovaniceNovcanice/1euro.jpg') }}" alt="1€" data-value="1">
                            <input type="number" id="novcanica-1" name="novcanica-1" value="">
                        </div>
                        <div class="currency-item">
                            <img src="{{ url_for('static', filename='KovaniceNovcanice/2euro.jpg') }}" alt="2€" data-value="2">
                            <input type="number" id="novcanica-2" name="novcanica-2" value="">
                        </div>
                        <div class="currency-item">
                            <label>Gotovina (€):</label>
                            <input type="number" id="gotovina" name="gotovina">
                        </div>
                    </div>
                </div>
                <div class="section currency">
                    <h2>Novčanice</h2>
                    <div class="currency-input">
                        <!-- Novčanice -->
                        <div class="currency-item">
                            <img src="{{ url_for('static', filename='KovaniceNovcanice/5euro.jpg') }}" alt="5€" data-value="5">
                            <input type="number" id="novcanica-5" name="novcanica-5" value="">
                        </div>
                        <div class="currency-item">
                            <img src="{{ url_for('static', filename='KovaniceNovcanice/10euro.jpg') }}" alt="10€" data-value="10">
                            <input type="number" id="novcanica-10" name="novcanica-10" value="">
                        </div>
                        <div class="currency-item">
                            <img src="{{ url_for('static', filename='KovaniceNovcanice/20euro.jpg') }}" alt="20€" data-value="20">
                            <input type="number" id="novcanica-20" name="novcanica-20" value="">
                        </div>
                        <div class="currency-item">
                            <img src="{{ url_for('static', filename='KovaniceNovcanice/50euro.jpg') }}" alt="50€" data-value="50">
                            <input type="number" id="novcanica-50" name="novcanica-50" value="">
                        </div>
                        <div class="currency-item">
                            <img src="{{ url_for('static', filename='KovaniceNovcanice/100euro.jpg') }}" alt="100€" data-value="100">
                            <input type="number" id="novcanica-100" name="novcanica-100" value="">
                        </div>
                        <div class="currency-item">
                            <img src="{{ url_for('static', filename='KovaniceNovcanice/200euro.jpg') }}" alt="200€" data-value="200">
                            <input type="number" id="novcanica-200" name="novcanica-200" value="">
                        </div>
                    </div>
                </div>
            </div>
            <div class="button-container">
                <button type="button" id="izracunaj-button">IZRAČUNAJ</button>
            </div>
        </form>
    </div>

    <!-- Modalni prozor za prikaz rezultata -->
<div id="resultModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span> <!-- Dodaj ovo za zatvaranje prozora -->
        <div class="currency-columns">
            <div id="prilagodeniDetails" class="currency-column"></div>
        </div>
        <!-- Dodaj result div ispod svih elemenata -->
        <div id="result" class="result-modal"></div>
    </div>
</div>



    <script>
        const staticImagePaths = {
            '0.1': "{{ url_for('static', filename='KovaniceNovcanice/0.1euro.jpg') }}",
            '0.2': "{{ url_for('static', filename='KovaniceNovcanice/0.2euro.jpg') }}",
            '0.5': "{{ url_for('static', filename='KovaniceNovcanice/0.5euro.jpg') }}",
            '1': "{{ url_for('static', filename='KovaniceNovcanice/1euro.jpg') }}",
            '2': "{{ url_for('static', filename='KovaniceNovcanice/2euro.jpg') }}",
            '5': "{{ url_for('static', filename='KovaniceNovcanice/5euro.jpg') }}",
            '10': "{{ url_for('static', filename='KovaniceNovcanice/10euro.jpg') }}",
            '20': "{{ url_for('static', filename='KovaniceNovcanice/20euro.jpg') }}",
            '50': "{{ url_for('static', filename='KovaniceNovcanice/50euro.jpg') }}",
            '100': "{{ url_for('static', filename='KovaniceNovcanice/100euro.jpg') }}",
            '200': "{{ url_for('static', filename='KovaniceNovcanice/200euro.jpg') }}"
        };
    </script>





<!-- 1) AUTO REFRESH (15 min neaktivnosti) -->
<script>
let timeout;

function resetTimer() {
    clearTimeout(timeout);
    timeout = setTimeout(() => {
        location.reload(); // Osvježavanje stranice
    }, 900000); // 15 minuta (900,000 ms)
}

// Resetuj tajmer na bilo koju interakciju korisnika
document.addEventListener("mousemove", resetTimer);
document.addEventListener("keydown", resetTimer);
document.addEventListener("click", resetTimer);
document.addEventListener("scroll", resetTimer);

resetTimer(); // Pokreće inicijalni tajmer
</script>






<!-- 2) GLAVNA LOGIKA (račun, prikaz, slanje) -->
<script>
const modal = document.getElementById("resultModal");
const span = document.getElementsByClassName("close")[0];

document.getElementById('izracunaj-button').addEventListener('click', async function() {
    const pocetniPolog = parseFloat(document.getElementById('pocetni-polog').value) || 0;
    const dnevniPromet = parseFloat(document.getElementById('dnevni-promet').value) || 0;

    const ukupnoStvarno = pocetniPolog + dnevniPromet;
    const ukupnoSaNemaknutim = ukupnoStvarno;
    const ukupnoBezNemaknutog = ukupnoSaNemaknutim;

    let stvarno = 0;

    const novcaniceVrijednosti = {
        '5': 5, '10': 10, '20': 20, '50': 50, '100': 100, '200': 200
    };
    const novcaniceKolicine = {};

    const kovaniceVrijednosti = {
        '0.1': 0.1, '0.2': 0.2, '0.5': 0.5, '1': 1, '2': 2
    };
    const kovaniceKolicine = {};

    // Računanje stvarnog iznosa
    Object.keys(kovaniceVrijednosti).forEach(key => {
        const kolicina = parseFloat(document.getElementById(`novcanica-${key}`).value) || 0;
        stvarno += kolicina * kovaniceVrijednosti[key];
        kovaniceKolicine[key] = kolicina;
    });

    Object.keys(novcaniceVrijednosti).forEach(key => {
        const kolicina = parseFloat(document.getElementById(`novcanica-${key}`).value) || 0;
        stvarno += kolicina * novcaniceVrijednosti[key];
        novcaniceKolicine[key] = kolicina;
    });

    const gotovina = parseFloat(document.getElementById('gotovina').value) || 0;
    stvarno += gotovina;

    const razlika = stvarno - ukupnoSaNemaknutim;
    let status = "Taman";
    let resultClass = 'exact';

    if (razlika > 0) {
        status = `VIŠAK: ${razlika.toFixed(2)} €`;
        resultClass = 'positive';
    } else if (razlika < 0) {
        status = `MANJAK: ${Math.abs(razlika).toFixed(2)} €`;
        resultClass = 'negative';
    }

    // Postavite ciljni zbroj na ukupnoBezNemaknutog
    let ciljniZbroj = ukupnoBezNemaknutog + razlika;
    let trenutniZbroj = stvarno;

    const prioritetiSmanjenja = [
        { key: '20', type: 'novcanica' }
    ];

    const prioritetiPovecanja = [
        { key: '10', type: 'novcanica' },
        { key: '5', type: 'novcanica' },
        { key: '2', type: 'kovanica' },
        { key: '1', type: 'kovanica' },
        { key: '0.5', type: 'kovanica' },
        { key: '0.2', type: 'kovanica' },
        { key: '0.1', type: 'kovanica' }
    ];

    // Prvo smanjujemo veće apoene
    for (const prioritet of prioritetiSmanjenja) {
        const { key, type } = prioritet;
        const vrijednost = type === 'novcanica' ? novcaniceVrijednosti[key] : kovaniceVrijednosti[key];
        let kolicina = type === 'novcanica' ? novcaniceKolicine[key] : kovaniceKolicine[key];

        while (kolicina > 0 && trenutniZbroj > ciljniZbroj) {
            kolicina--;
            trenutniZbroj -= vrijednost;

            if (type === 'novcanica') {
                novcaniceKolicine[key] = kolicina;
            } else {
                kovaniceKolicine[key] = kolicina;
            }

            if (trenutniZbroj <= ciljniZbroj) {
                break;
            }
        }

        if (trenutniZbroj <= ciljniZbroj) {
            break;
        }
    }

    // Zatim povećavamo manje apoene dok ne postignemo ciljni zbroj
    for (const prioritet of prioritetiPovecanja) {
        const { key, type } = prioritet;
        const vrijednost = type === 'novcanica' ? novcaniceVrijednosti[key] : kovaniceVrijednosti[key];
        let kolicina = type === 'novcanica' ? novcaniceKolicine[key] : kovaniceKolicine[key];

        while (trenutniZbroj < ciljniZbroj) {
            if (trenutniZbroj + vrijednost > ciljniZbroj) {
                break;
            }
            kolicina++;
            trenutniZbroj += vrijednost;

            if (type === 'novcanica') {
                novcaniceKolicine[key] = kolicina;
            } else {
                kovaniceKolicine[key] = kolicina;
            }

            if (trenutniZbroj >= ciljniZbroj) {
                break;
            }
        }

        if (trenutniZbroj >= ciljniZbroj) {
            break;
        }
    }

    const resultDiv = document.getElementById('result');
    resultDiv.className = `result-widget ${resultClass === 'exact' ? 'status-exact' : resultClass === 'positive' ? 'status-positive' : 'status-negative'}`;
    resultDiv.innerHTML = `
        <div>Trebaš imati: ${ukupnoStvarno.toFixed(2)} €</div>
        <div>Ti imaš: ${(stvarno).toFixed(2)} €</div>
        <div>Rezultat: ${status}</div>
    `;

    // Prikaz prilagođenih unosa s točnim putanjama za slike
    let prilagodeniDetails = '<div><strong></strong></div>';
    let detaljiKovanice = '';
    let detaljiNovcanice = '';

    // Generiramo HTML za kovanice
    Object.keys(kovaniceVrijednosti).sort((a, b) => parseFloat(a) - parseFloat(b)).forEach(key => {
        let prilagodeniIznos = kovaniceKolicine[key] * kovaniceVrijednosti[key];
        let kolicina = kovaniceKolicine[key];
        let slikaSrc = staticImagePaths[key];

        if (kolicina > 0) {
            detaljiKovanice += `<div class="currency-items" style="display: flex; align-items: center; width: 100%; font-size: 26px;">
                                    <img src="${slikaSrc}" alt="${key}€" style="height: 50px; margin-right: 10px;">
                                    <span>${kolicina} * ${key}€ = ${prilagodeniIznos.toFixed(2)}€</span>
                                </div>`;
        }
    });

    // Dodajemo gotovinu ispod kovanica, formatirano kao traženo
    if (gotovina > 0) {
        detaljiKovanice += `<div class="currency-items" style="display: flex; align-items: center; width: 100%; font-size: 26px;">
                                <span style="text-align: right;">Gotovina: ${gotovina} * 1€ = ${gotovina.toFixed(2)} €</span>
                            </div>`;
    }

    // Generiramo HTML za novčanice
    Object.keys(novcaniceVrijednosti).sort((a, b) => parseFloat(a) - parseFloat(b)).forEach(key => {
        let prilagodeniIznos = novcaniceKolicine[key] * novcaniceVrijednosti[key];
        let kolicina = novcaniceKolicine[key];
        let slikaSrc = staticImagePaths[key];

        if (kolicina > 0) {
            detaljiNovcanice += `<div class="currency-items" style="display: flex; align-items: center; width: 100%; font-size: 26px;">
                                    <img src="${slikaSrc}" alt="${key}€" style="height: 50px; margin-right: 10px;">
                                    <span>${kolicina} * ${key}€ = ${prilagodeniIznos.toFixed(2)}€</span>
                                </div>`;
        }
    });

    // Prikaz u dvije kolone + zbroj
    prilagodeniDetails += `<div class="currency-columns">
                                <div class="currency-left">${detaljiKovanice}</div>
                                <div class="currency-right">${detaljiNovcanice}</div>
                            </div>
                            <div style="text-align: right; font-size: 26px;"><strong>Zbroj svega:</strong> ${(stvarno).toFixed(2)} €</div>`;

    document.getElementById('prilagodeniDetails').innerHTML = prilagodeniDetails;

    // Prikaz modalnog prozora
    modal.classList.add("maximize-modal");
    modal.style.display = "block";

    // Slanje na server
    const response = await fetch('/save_calculation', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            pocetni_polog: pocetniPolog,
            dnevni_promet: dnevniPromet,
            ukupno: ukupnoStvarno,
            stvarno: stvarno,
            status: status,
            novcanice: novcaniceKolicine,
            kovanice: kovaniceKolicine,
            gotovina: gotovina
        })
    });

    const saveResult = await response.json();
    if (saveResult.success) {
        console.log('Calculation saved successfully');
    } else {
        console.error('Error saving calculation:', saveResult.message);
    }
});
</script>







<!-- 3) MODAL CLOSE -->
<script>
span.onclick = function() {
    modal.style.display = "none";
};
</script>









<!-- 4) ENTER NAVIGACIJA + AUTO-SELECT INPUTA -->
<script>
document.querySelectorAll('input').forEach((input, index, inputs) => {
    input.addEventListener('keydown', function(event) {
        if (event.key === 'Enter') {
            event.preventDefault(); // Sprječava zadano ponašanje Enter tipke
            const nextInput = inputs[index + 1]; // Dohvati sljedeći input
            if (nextInput) {
                nextInput.focus(); // Postavi fokus na sljedeći input
            } else {
                inputs[0].focus(); // Vrati fokus na prvi input ako je zadnji polje
            }
        }
    });
});

document.querySelectorAll('input').forEach(input => {
    input.addEventListener('focus', function() {
        input.select(); // Selektira cijeli sadržaj unutar polja kada dobije fokus
    });
});
</script>




</body>
</html>
