<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Spotify + Radio Dalmacija Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tvoj postojeƒái Spotify stilovi -->
  <link rel="stylesheet" href="/static/css/spotify.css" />

  <!-- Minimalni stil samo za Radio Dalmacija karticu (namespaced: rd-*) -->
  <style>
    .rd-card {
      background: #111827; color: #e2e8f0;
      border-radius: 16px; padding: 14px; margin-bottom: 18px;
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
    }
    .rd-row { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    .rd-title { font-weight:700; font-size:1.05rem; letter-spacing:.2px; }
    .rd-status { font-size:.9rem; opacity:.85; margin-left:auto; }
    .rd-controls button {
      border:0; border-radius:10px; padding:8px 12px; cursor:pointer;
      background:#10b981; color:#052e26; font-weight:700;
    }
    .rd-controls button.rd-muted { background:#334155; color:#e2e8f0; }
    .rd-controls input[type="range"] { width:160px; }
    .rd-marquee { overflow:hidden; white-space:nowrap;
      mask-image:linear-gradient(90deg,transparent 0,#000 10%,#000 90%,transparent 100%);
      -webkit-mask-image:linear-gradient(90deg,transparent 0,#000 10%,#000 90%,transparent 100%);
      margin-top:6px;
    }
    .rd-marquee span { display:inline-block; padding-left:100%; animation:rd-scroll 12s linear infinite; }
    @keyframes rd-scroll { from{ transform:translateX(0);} to{ transform:translateX(-100%);} }

    /* Layout hint: ako ≈æeli≈° RD karticu desno od Spotify playera, mo≈æe≈° koristiti flex u .container u svom CSS-u */
  </style>
</head>
<body>

  <div class="container">

    <!-- RADIO DALMACIJA ‚Äì KARTICA -->
    <section class="rd-card" id="radioDalmacija">
      <div class="rd-row" style="justify-content:space-between;">
        <div class="rd-title">üéß Radio Dalmacija ‚Äî Live</div>
        <div class="rd-status" id="rdStatus">Spremno</div>
      </div>

      <div class="rd-controls rd-row" style="margin-top:10px;">
        <button id="rdPlay">‚ñ∂Ô∏é Play</button>
        <button id="rdPause" class="rd-muted">‚è∏Ô∏é Pauza</button>
        <label>Glasnoƒáa:
          <input id="rdVolume" type="range" min="0" max="1" step="0.01" value="0.9">
        </label>
        <button id="rdMute" class="rd-muted">üîá Mute</button>
      </div>

      <div class="rd-marquee">
        <span id="rdNow">Spajam se na Radio Dalmaciju‚Ä¶</span>
      </div>

      <!-- Direktni HTTPS stream ‚Äì izbjegava mixed content na HTTPS sajtu -->
      <audio id="rdAudio" preload="none" crossorigin="anonymous">
        <!-- HE-AAC stream; ako ti ne svira u nekom browseru, javi da dodamo proxy ili alternativu -->
        <source src="https://shoutcast.pondi.hr:9000/;" type="audio/aac">
        Tvoj browser ne podr≈æava HTML5 audio.
      </audio>
    </section>
    <!-- /RADIO DALMACIJA -->

    <!-- SPOTIFY UI (tvoj postojeƒái markup ostaje netaknut) -->
    <div class="playlist-section">
      <h2>Moje Playliste</h2>
      <ul id="playlistList"></ul>
    </div>

    <div class="player">
      <img id="albumImage" src="" alt="Album Cover">
      <div class="track-info">
        <div id="trackName">Track Name</div>
        <div id="artistName">Artist</div>
      </div>

      <div class="controls">
        <button onclick="previousTrack()">‚èÆ Prethodna pjesma</button>
        <button onclick="togglePlay()" id="playPause">PAUSE</button>
        <button onclick="nextTrack()">Sljedeƒáa pjesma ‚è≠</button>
      </div>

      <div class="seek-bar">
        <input type="range" id="seekSlider" value="0" min="0" max="100" step="1" oninput="seekToPosition(this.value)">
      </div>

      <div class="volume-controls">
        <div class="volume-buttons">
          <button onclick="setVolume(0.0)">0%</button>
          <button onclick="setVolume(0.2)">20%</button>
          <button onclick="setVolume(0.5)">50%</button>
          <button onclick="setVolume(0.6)">60%</button>
          <button onclick="setVolume(0.7)">70%</button>
          <button onclick="setVolume(0.8)">80%</button>
          <button onclick="setVolume(0.9)">90%</button>
          <button onclick="setVolume(1.0)">100%</button>
        </div>
      </div>
    </div>

    <div class="tracks-section">
      <div class="tracks-header">
        <h2>Pjesme u playlisti</h2>
        <button id="uiShuffle" onclick="shuffleTrackList()">Izmije≈°aj prikaz</button>
      </div>
      <ul id="tracksList"></ul>
    </div>

  </div>

  <!-- Spotify SDK + tvoj kod -->
  <script src="https://sdk.scdn.co/spotify-player.js"></script>
  <script src="/static/js/spotify.js"></script>

  <!-- Radio Dalmacija kontrolna logika (namespaced, ne dira Spotify kod) -->
  <script>
    (function(){
      const audio  = document.getElementById('rdAudio');
      const playB  = document.getElementById('rdPlay');
      const pauseB = document.getElementById('rdPause');
      const muteB  = document.getElementById('rdMute');
      const vol    = document.getElementById('rdVolume');
      const status = document.getElementById('rdStatus');
      const nowEl  = document.getElementById('rdNow');

      let retryCount = 0, maxRetries = 5;

      function setStatus(txt){ status.textContent = txt; }
      function setNow(txt){ nowEl.textContent = txt; }

      async function start() {
        try {
          setStatus('Poku≈°avam reproducirati‚Ä¶');
          await audio.play();
          setStatus('Reproduciram ‚úÖ');
        } catch (e) {
          setStatus('Klikni ‚ÄúPlay‚Äù (autoplay blokiran).');
          console.warn('[RD] play error', e);
        }
      }

      function stop() {
        audio.pause();
        setStatus('Pauzirano ‚è∏');
      }

      function scheduleReconnect() {
        if (retryCount < maxRetries) {
          retryCount++;
          const delay = Math.min(1500 * retryCount, 7000);
          setTimeout(() => { audio.load(); audio.play().catch(()=>{}); }, delay);
        } else {
          setStatus('Ne mo≈æe se spojiti. Provjeri dostupnost streama.');
        }
      }

      audio.addEventListener('error', () => {
        setStatus('Gre≈°ka na streamu. Poku≈°avam ponovo‚Ä¶');
        scheduleReconnect();
      });

      audio.addEventListener('stalled', () => {
        setStatus('Veza je zastala‚Ä¶ poku≈°avam ponovo.');
        scheduleReconnect();
      });

      audio.addEventListener('playing', () => {
        retryCount = 0;
        setStatus('Reproduciram ‚úÖ');
        setNow('Sviramo najbolje hitove üéµ');
      });

      // UI kontrole
      playB.addEventListener('click', start);
      pauseB.addEventListener('click', stop);
      muteB.addEventListener('click', () => {
        audio.muted = !audio.muted;
        muteB.textContent = audio.muted ? 'üîä Unmute' : 'üîá Mute';
      });
      vol.addEventListener('input', () => { audio.volume = vol.valueAsNumber; });

      // Po ≈æelji mo≈æe≈° automatski zaustaviti Spotify kad krene RD (i obrnuto).
      // Ovdje samo ≈°aljemo event koji mo≈æe≈° uhvatiti u spotify.js ako ≈æeli≈° pauzirati Spotify.
      audio.addEventListener('play', () => document.dispatchEvent(new CustomEvent('rd:playing')));
      audio.addEventListener('pause', () => document.dispatchEvent(new CustomEvent('rd:paused')));
    })();
  </script>
</body>
</html>
