<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Spotify + Radio Dalmacija + Naxi Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tvoji postojeƒái Spotify stilovi -->
  <link rel="stylesheet" href="/static/css/spotify.css" />

  <!-- Stil za Radio kartice (RD i Naxi) -->
  <style>
    /* RD i Naxi kartice koriste isti vizuelni stil */
    .radio-card {
      background: #111827; color: #e2e8f0;
      border-radius: 16px; padding: 14px; margin-bottom: 18px;
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
    }
    .radio-row { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    .radio-title { font-weight:700; font-size:1.05rem; letter-spacing:.2px; }
    .radio-status { font-size:.9rem; opacity:.85; margin-left:auto; }
    .radio-controls button {
      border:0; border-radius:10px; padding:8px 12px; cursor:pointer;
      background:#10b981; color:#052e26; font-weight:700;
    }
    .radio-controls button.is-muted { background:#334155; color:#e2e8f0; }
    .radio-controls input[type="range"] { width:160px; }
    .radio-marquee { overflow:hidden; white-space:nowrap;
      mask-image:linear-gradient(90deg,transparent 0,#000 10%,#000 90%,transparent 100%);
      -webkit-mask-image:linear-gradient(90deg,transparent 0,#000 10%,#000 90%,transparent 100%);
      margin-top:6px;
    }
    .radio-marquee span { display:inline-block; padding-left:100%; animation:marq-scroll 12s linear infinite; }
    @keyframes marq-scroll { from{ transform:translateX(0);} to{ transform:translateX(-100%);} }
  </style>
</head>
<body>

  <div class="container">

    <!-- PLAYLISTE -->
    <div class="playlist-section">
      <h2>Moje Playliste</h2>
      <ul id="playlistList"></ul>

      <!-- RADIO DALMACIJA ‚Äì KARTICA -->
      <section class="radio-card" id="radioDalmacija">
        <div class="radio-row" style="justify-content:space-between;">
          <div class="radio-title">üéß Radio Dalmacija ‚Äî Live</div>
          <div class="radio-status" id="rdStatus">Spremno</div>
        </div>

        <div class="radio-controls radio-row" style="margin-top:10px;">
          <button id="rdPlay">‚ñ∂Ô∏é Play</button>
          <button id="rdPause" class="is-muted">‚è∏Ô∏é Pauza</button>
          <label>Glasnoƒáa:
            <input id="rdVolume" type="range" min="0" max="1" step="0.01" value="0.9">
          </label>
          <button id="rdMute" class="is-muted">üîá Mute</button>
        </div>

        <div class="radio-marquee">
          <span id="rdNow">Spajam se na Radio Dalmaciju‚Ä¶</span>
        </div>

        <!-- Direktni HTTPS stream (HE-AAC) -->
        <audio id="rdAudio" preload="none" crossorigin="anonymous">
          <source src="https://shoutcast.pondi.hr:9000/;" type="audio/aac">
          Tvoj browser ne podr≈æava HTML5 audio.
        </audio>
      </section>

      <!-- NAXI RADIO ‚Äì KARTICA -->
      <section class="radio-card" id="naxiRadio">
        <div class="radio-row" style="justify-content:space-between;">
          <div class="radio-title">üìª Naxi Radio ‚Äî Live</div>
          <div class="radio-status" id="nxStatus">Spremno</div>
        </div>

        <div class="radio-controls radio-row" style="margin-top:10px;">
          <button id="nxPlay">‚ñ∂Ô∏é Play</button>
          <button id="nxPause" class="is-muted">‚è∏Ô∏é Pauza</button>
          <label>Glasnoƒáa:
            <input id="nxVolume" type="range" min="0" max="1" step="0.01" value="0.9">
          </label>
          <button id="nxMute" class="is-muted">üîá Mute</button>
        </div>

        <div class="radio-marquee">
          <span id="nxNow">Spajam se na Naxi Radio‚Ä¶</span>
        </div>

        <!-- Direktni HTTPS stream (MP3 128 kbps). Alternativa: 64 kbps na https://naxi64.streaming.rs:9162/; -->
        <audio id="nxAudio" preload="none" crossorigin="anonymous">
          <source src="https://naxi128.streaming.rs:9152/;" type="audio/mpeg">
          <!-- <source src="https://naxi64.streaming.rs:9162/;" type="audio/mpeg"> -->
          Tvoj browser ne podr≈æava HTML5 audio.
        </audio>
      </section>
    </div>

    <!-- SPOTIFY PLAYER (postojeƒái markup) -->
    <div class="player">
      <img id="albumImage" src="" alt="Album Cover">
      <div class="track-info">
        <div id="trackName">Track Name</div>
        <div id="artistName">Artist</div>
      </div>

      <div class="controls">
        <button onclick="previousTrack()">‚èÆ Prethodna pjesma</button>
        <button onclick="togglePlay()" id="playPause">PAUSE</button>
        <button onclick="nextTrack()">Sljedeƒáa pjesma ‚è≠</button>
      </div>

      <div class="seek-bar">
        <input type="range" id="seekSlider" value="0" min="0" max="100" step="1" oninput="seekToPosition(this.value)">
      </div>

      <div class="volume-controls">
        <div class="volume-buttons">
          <button onclick="setVolume(0.0)">0%</button>
          <button onclick="setVolume(0.2)">20%</button>
          <button onclick="setVolume(0.5)">50%</button>
          <button onclick="setVolume(0.6)">60%</button>
          <button onclick="setVolume(0.7)">70%</button>
          <button onclick="setVolume(0.8)">80%</button>
          <button onclick="setVolume(0.9)">90%</button>
          <button onclick="setVolume(1.0)">100%</button>
        </div>
      </div>
    </div>

    <div class="tracks-section">
      <div class="tracks-header">
        <h2>Pjesme u playlisti</h2>
        <button id="uiShuffle" onclick="shuffleTrackList()">Izmije≈°aj prikaz</button>
      </div>
      <ul id="tracksList"></ul>
    </div>

  </div>

  <!-- Spotify SDK + tvoj JS -->
  <script src="https://sdk.scdn.co/spotify-player.js"></script>
  <script src="/static/js/spotify.js"></script>

  <!-- Kontrola za oba radio playera (nezavisno od Spotify koda) -->
  <script>
    // Helper za kreiranje kontrolera za jedan <audio>
    function setupRadioControls({audioId, playId, pauseId, muteId, volumeId, statusId, nowId, label}) {
      const audio  = document.getElementById(audioId);
      const playB  = document.getElementById(playId);
      const pauseB = document.getElementById(pauseId);
      const muteB  = document.getElementById(muteId);
      const vol    = document.getElementById(volumeId);
      const status = document.getElementById(statusId);
      const nowEl  = document.getElementById(nowId);

      let retryCount = 0, maxRetries = 5;

      const setStatus = (t)=> status.textContent = t;
      const setNow    = (t)=> nowEl.textContent = t;

      async function start() {
        try {
          setStatus('Poku≈°avam reproducirati‚Ä¶');
          await audio.play();
          setStatus('Reproduciram ‚úÖ');
          document.dispatchEvent(new CustomEvent(label + ':playing'));
        } catch (e) {
          setStatus('Klikni ‚ÄúPlay‚Äù (autoplay blokiran).');
          console.warn(`[${label}] play error`, e);
        }
      }

      function stop() {
        audio.pause();
        setStatus('Pauzirano ‚è∏');
        document.dispatchEvent(new CustomEvent(label + ':paused'));
      }

      function scheduleReconnect() {
        if (retryCount < maxRetries) {
          retryCount++;
          const delay = Math.min(1500 * retryCount, 7000);
          setTimeout(() => { audio.load(); audio.play().catch(()=>{}); }, delay);
        } else {
          setStatus('Ne mo≈æe se spojiti. Provjeri dostupnost streama.');
        }
      }

      audio.addEventListener('error',   () => { setStatus('Gre≈°ka na streamu. Poku≈°avam ponovo‚Ä¶'); scheduleReconnect(); });
      audio.addEventListener('stalled', () => { setStatus('Veza je zastala‚Ä¶ poku≈°avam ponovo.');   scheduleReconnect(); });
      audio.addEventListener('playing', () => { retryCount = 0; setStatus('Reproduciram ‚úÖ'); setNow('Sviramo najbolje hitove üéµ'); });

      playB.addEventListener('click', start);
      pauseB.addEventListener('click', stop);
      muteB.addEventListener('click', () => {
        audio.muted = !audio.muted;
        muteB.textContent = audio.muted ? 'üîä Unmute' : 'üîá Mute';
      });
      vol.addEventListener('input', () => { audio.volume = vol.valueAsNumber; });
    }

    // Inicijalizuj oba
    setupRadioControls({
      audioId:'rdAudio', playId:'rdPlay', pauseId:'rdPause', muteId:'rdMute',
      volumeId:'rdVolume', statusId:'rdStatus', nowId:'rdNow', label:'rd'
    });

    setupRadioControls({
      audioId:'nxAudio', playId:'nxPlay', pauseId:'nxPause', muteId:'nxMute',
      volumeId:'nxVolume', statusId:'nxStatus', nowId:'nxNow', label:'nx'
    });

    // Ako ≈æeli≈°: pauziraj Spotify ƒçim neki radio krene (uhvati event u svom spotify.js)
    document.addEventListener('rd:playing', () => {/* opcionalno pauziraj Spotify */});
    document.addEventListener('nx:playing', () => {/* opcionalno pauziraj Spotify */});
  </script>
</body>
</html>
