<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8" />
  <title>Spotify + 3 Radio Playera</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- (Opcionalno) tvoj postojeƒái CSS; na≈° novi CSS ispod sve preuzima -->
  <link rel="stylesheet" href="/static/css/spotify.css" />

  <!-- ===== NOVI GLOBALNI CSS ===== -->
  <style>
    :root{
      --bg:#0b1020;
      --card:#11182a;
      --soft:#0f1526;
      --text:#e8eef7;
      --sub:#a7b2c6;
      --accent:#10b981;
      --accent-2:#1db954; /* spotify zelena */
      --radius:16px;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --gap:18px;
      --gap-lg:22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 30% -10%, #17213f 0%, #0b1020 55%, #0b1020 100%);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
    }

    .page{
      max-width:1280px;
      margin:0 auto;
      padding:22px var(--gap);
      display:grid;
      grid-template-rows:auto auto;
      gap:var(--gap-lg);
    }

    .btn{
      appearance:none; border:0; cursor:pointer;
      background:var(--accent-2); color:#062d16;
      padding:10px 16px; border-radius:12px; font-weight:800;
      transition:transform .06s ease, filter .12s ease;
    }
    .btn:active{ transform:translateY(1px) }
    .btn.alt{ background:var(--accent); color:#04281f }

    /* Red 1: 3 kartice (2 radija + Spotify) */
    .radios-grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:var(--gap-lg);
    }
    .radio-card{
      background:linear-gradient(180deg, var(--card), var(--soft));
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
      display:flex; flex-direction:column; gap:10px;
      min-height:160px;
    }
    .radio-head{
      display:flex; align-items:center; gap:10px;
    }
    .radio-title{
      font-weight:800; letter-spacing:.2px; font-size:1.02rem;
    }
    .radio-status{
      margin-left:auto; font-size:.9rem; color:var(--sub);
    }
    .radio-controls{
      display:flex; align-items:center; gap:12px; flex-wrap:wrap;
    }
    .vol{
      display:flex; align-items:center; gap:8px; color:var(--sub); font-size:.9rem;
    }
    .vol input[type="range"]{ width:180px; }

    .ticker{
      overflow:hidden; white-space:nowrap;
      -webkit-mask-image:linear-gradient(90deg,transparent 0,#000 8%,#000 92%,transparent 100%);
      mask-image:linear-gradient(90deg,transparent 0,#000 8%,#000 92%,transparent 100%);
      font-size:.95rem; color:#dfe8f7;
    }
    .ticker span{ display:inline-block; padding-left:100%; animation:ticker 12s linear infinite; }
    @keyframes ticker{ from{ transform:translateX(0);} to{ transform:translateX(-100%);} }

    /* Red 2: Playlists (lijevo) i Tracks (desno) */
    .content-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:var(--gap-lg);
      align-items:stretch;
    }
    .panel{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
      display:flex; flex-direction:column; min-height:340px;
    }
    .panel h3{ margin:0 0 10px 0; font-size:1.02rem; letter-spacing:.2px; }
    .list{
      list-style:none; margin:0; padding:0; overflow:auto; flex:1;
    }
    .list li{
      background:#17213b; margin:8px 0; padding:10px 12px; border-radius:10px;
      cursor:pointer; transition:filter .12s ease, transform .06s ease;
    }
    .list li:hover{ filter:brightness(1.07); transform:translateY(-1px); }

    /* Tracks lista stil (kompaktno) */
    .track-item{ display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:10px; }
    .track-item:hover{ background:#1a2747; }
    .track-thumb{ width:44px;height:44px;border-radius:6px;object-fit:cover;background:#24345e;flex:0 0 44px; }
    .track-text{ min-width:0; }
    .track-title{ font-weight:700; font-size:.95rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .track-artist{ color:var(--sub); font-size:.82rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .track-item.playing{ outline:1px solid #3a7bd5; background:#15294f; }

    /* Skrivene stvari koje spotify.js i dalje koristi */
    .sr-only{ display:none !important; }

    /* Scrollbar suptilno */
    .list::-webkit-scrollbar{ width:8px }
    .list::-webkit-scrollbar-thumb{ background:#1f2c4c; border-radius:8px }

    /* Responsivno: tablet = 2 kolone u prvom redu, mob = 1 */
    @media (max-width: 1100px){
      .radios-grid{ grid-template-columns: repeat(2,1fr); }
      .content-grid{ grid-template-columns: 1fr; }
    }
    @media (max-width: 800px){
      .radios-grid{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="page">

    <!-- RED 1: Radio Dalmacija + Naxi + Spotify (tri iste kartice) -->
    <section class="radios-grid">

      <!-- Radio Dalmacija -->
      <article class="radio-card" id="rd-card">
        <div class="radio-head">
          <div class="radio-title">üéß Radio Dalmacija ‚Äî Live</div>
          <div id="rd-status" class="radio-status">Spremno</div>
        </div>
        <div class="radio-controls">
          <button id="rd-play" class="btn alt">‚ñ∂ Play</button>
          <div class="vol">
            <span>Glasnoƒáa</span>
            <input id="rd-vol" type="range" min="0" max="1" step="0.01" value="0.9">
          </div>
        </div>
        <div class="ticker"><span id="rd-now">Spajam se na Radio Dalmaciju‚Ä¶</span></div>
        <audio id="rd-audio" preload="none">
          <source src="https://shoutcast.pondi.hr:9000/;" type="audio/aac">
        </audio>
      </article>

      <!-- Naxi Radio -->
      <article class="radio-card" id="nx-card">
        <div class="radio-head">
          <div class="radio-title">üìª Naxi Radio ‚Äî Live</div>
          <div id="nx-status" class="radio-status">Spremno</div>
        </div>
        <div class="radio-controls">
          <button id="nx-play" class="btn alt">‚ñ∂ Play</button>
          <div class="vol">
            <span>Glasnoƒáa</span>
            <input id="nx-vol" type="range" min="0" max="1" step="0.01" value="0.9">
          </div>
        </div>
        <div class="ticker"><span id="nx-now">Spajam se na Naxi Radio‚Ä¶</span></div>
        <audio id="nx-audio" preload="none">
          <source src="https://naxi128ssl.streaming.rs:9152/;" type="audio/mpeg">
          <source src="https://naxi64ssl.streaming.rs:9162/;" type="audio/mpeg">
        </audio>
      </article>

      <!-- Spotify kao treƒáa kartica -->
      <article class="radio-card" id="sp-card">
        <div class="radio-head">
          <div class="radio-title">üéµ Spotify ‚Äî Player</div>
          <div id="sp-status" class="radio-status">Spremno</div>
        </div>
        <div class="radio-controls">
          <button id="playPause" class="btn">‚ñ∂ Play</button>
        </div>
        <div class="ticker"><span>Odaberi playlistu ispod pa klikni Play.</span></div>

        <!-- Skrivene mete koje spotify.js oƒçekuje -->
        <div class="sr-only">
          <img id="albumImage" alt="">
          <div id="trackName"></div>
          <div id="artistName"></div>
          <input type="range" id="seekSlider" value="0" min="0" max="100" step="1">
        </div>
      </article>

    </section>

    <!-- RED 2: Playliste (lijevo) i Pjesme (desno) -->
    <section class="content-grid">

      <!-- Moje Playliste -->
      <article class="panel">
        <h3>üìö Moje playliste</h3>
        <ul id="playlistList" class="list"></ul>
      </article>

      <!-- Pjesme u playlisti -->
      <article class="panel">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
          <h3>üéº Pjesme u playlisti</h3>
          <button id="uiShuffle" onclick="shuffleTrackList()" class="btn">Izmije≈°aj prikaz</button>
        </div>
        <ul id="tracksList" class="list"></ul>
      </article>

    </section>
  </div>

  <!-- Spotify SDK + tvoj kod -->
  <script src="https://sdk.scdn.co/spotify-player.js"></script>
  <script src="/static/js/spotify.js"></script>

  <!-- ===== Radio logika (Play + Volume, bez Pause/Mute) ===== -->
  <script>
    // Kolekcija svih audio elemenata da samo jedan svira
    const allRadios = [];

    function makeRadio({ audioId, playId, volId, statusId, nowId, label }) {
      const a  = document.getElementById(audioId);
      const b  = document.getElementById(playId);
      const vr = document.getElementById(volId);
      const st = document.getElementById(statusId);
      const nw = document.getElementById(nowId);

      allRadios.push(a);

      let retries = 0, maxRetries = 5;
      const setStatus = t => st.textContent = t;
      const setNow    = t => nw.textContent = t;

      async function play() {
        try {
          // zaustavi sve ostale
          allRadios.forEach(x => { if (x !== a) x.pause(); });
          setStatus('Poku≈°avam reproducirati‚Ä¶');
          await a.play();
          setStatus('Reproduciram ‚úÖ');
        } catch (e) {
          setStatus('Klikni ‚ÄúPlay‚Äù (autoplay blokiran).');
          console.warn(`[${label}] play error`, e);
        }
      }

      function reconnect() {
        if (retries < maxRetries) {
          retries++;
          const delay = Math.min(1500 * retries, 7000);
          setTimeout(() => { a.load(); a.play().catch(()=>{}); }, delay);
        } else {
          setStatus('Ne mo≈æe se spojiti. Provjeri stream URL.');
        }
      }

      a.addEventListener('error',   () => { setStatus('Gre≈°ka na streamu. Poku≈°avam ponovo‚Ä¶'); reconnect(); });
      a.addEventListener('stalled', () => { setStatus('Veza je zastala‚Ä¶ poku≈°avam ponovo.');   reconnect(); });
      a.addEventListener('playing', () => { retries = 0; setStatus('Reproduciram ‚úÖ'); setNow('Sviramo najbolje hitove üéµ'); });

      b.addEventListener('click', play);
      vr && vr.addEventListener('input', () => { a.volume = vr.valueAsNumber; });

      return { play, setStatus, setNow, audio:a };
    }

    // Init 2 radija
    const RD = makeRadio({ audioId:'rd-audio', playId:'rd-play', volId:'rd-vol', statusId:'rd-status', nowId:'rd-now', label:'RD' });
    const NX = makeRadio({ audioId:'nx-audio', playId:'nx-play', volId:'nx-vol', statusId:'nx-status', nowId:'nx-now', label:'NAXI' });

    // Kad klikne≈° Spotify Play, pauziraj radio playere (da se ne mije≈°aju)
    document.getElementById('playPause').addEventListener('click', () => {
      allRadios.forEach(a => a.pause());
    });
  </script>
</body>
</html>
